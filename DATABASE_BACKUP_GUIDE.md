# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ùˆ Ø¨Ú©Ø§Ù¾ Ø¯ÛŒØªØ§Ø¨ÛŒØ³

## ğŸ“ Ù…Ø­Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³

Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¯Ø± Ù…Ø³ÛŒØ± Ø²ÛŒØ± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´Ù‡:
```
./data/installment_business.db
```

Ø§ÛŒÙ† Ù¾ÙˆØ´Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª volume Ø¨Ù‡ container Ù…ØªØµÙ„ Ø´Ø¯Ù‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø­ØªÛŒ Ø¨Ø¹Ø¯ Ø§Ø² restart Ø§Ø² Ø¨ÛŒÙ† Ù†Ù…ÛŒØ±Ù†.

## ğŸ”„ ØªÙ†Ø¸ÛŒÙ… Ø¨Ú©Ø§Ù¾ Ø®ÙˆØ¯Ú©Ø§Ø±

### 1. Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø¬Ø±Ø§ Ø¨Ù‡ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§:

```bash
chmod +x backup.sh restore.sh
```

### 2. ØªÙ†Ø¸ÛŒÙ… Cron Ø¨Ø±Ø§ÛŒ Ø¨Ú©Ø§Ù¾ Ø±ÙˆØ²Ø§Ù†Ù‡:

```bash
# Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† crontab
crontab -e

# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ† Ø®Ø· (Ø¨Ú©Ø§Ù¾ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø³Ø§Ø¹Øª 2 ØµØ¨Ø­)
0 2 * * * cd /path/to/install-pro-buddy && ./backup.sh >> /var/log/db-backup.log 2>&1
```

### 3. ØªØ³Øª Ø¨Ú©Ø§Ù¾ Ø¯Ø³ØªÛŒ:

```bash
./backup.sh
```

## ğŸ“¦ Ù…Ø­Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§

Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø³ÛŒØ± Ø²ÛŒØ± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´Ù†:
```
/root/backups/installment-db/
```

ÙØ±Ù…Øª Ù†Ø§Ù… ÙØ§ÛŒÙ„:
```
backup_20231130_020000.db.gz
```

## ğŸ”™ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¨Ú©Ø§Ù¾

### Ø±ÙˆØ´ 1: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø³Ú©Ø±ÛŒÙ¾Øª (ØªÙˆØµÛŒÙ‡ Ù…ÛŒØ´Ù‡)

```bash
./restore.sh
```

Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù„ÛŒØ³Øª Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§ Ø±Ùˆ Ù†Ø´ÙˆÙ† Ù…ÛŒØ¯Ù‡ Ùˆ Ù…ÛŒØªÙˆÙ†ÛŒ ÛŒÚ©ÛŒ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒ.

### Ø±ÙˆØ´ 2: Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø³ØªÛŒ

```bash
# ØªÙˆÙ‚Ù backend
docker compose stop backend

# Ø¨Ú©Ø§Ù¾ Ø§Ø­ØªÛŒØ§Ø·ÛŒ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙØ¹Ù„ÛŒ
cp ./data/installment_business.db ./data/installment_business.db.backup

# Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
gunzip -c /root/backups/installment-db/backup_20231130_020000.db.gz > ./data/installment_business.db

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
docker compose start backend
```

## ğŸ“Š Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§

### Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÛŒØ³Øª Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§:

```bash
ls -lh /root/backups/installment-db/
```

### Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø­Ø¬Ù… Ú©Ù„ Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§:

```bash
du -sh /root/backups/installment-db/
```

### Ø­Ø°Ù Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² 60 Ø±ÙˆØ²:

```bash
find /root/backups/installment-db/ -name "backup_*.db.gz" -mtime +60 -delete
```

## ğŸ” Ø¨Ú©Ø§Ù¾ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)

### Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ù‡ Google Drive Ø¨Ø§ rclone:

```bash
# Ù†ØµØ¨ rclone
curl https://rclone.org/install.sh | sudo bash

# ØªÙ†Ø¸ÛŒÙ… Google Drive
rclone config

# Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ú©Ø§Ù¾
rclone copy /root/backups/installment-db/ gdrive:installment-backups/
```

### Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ù‡ S3 (AWS):

```bash
# Ù†ØµØ¨ AWS CLI
apt install awscli

# ØªÙ†Ø¸ÛŒÙ… credentials
aws configure

# Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ú©Ø§Ù¾
aws s3 sync /root/backups/installment-db/ s3://your-bucket/installment-backups/
```

## ğŸš¨ Ø¨Ú©Ø§Ù¾ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ

Ø§Ú¯Ø± Ù…ÛŒØ®ÙˆØ§ÛŒ Ù‚Ø¨Ù„ Ø§Ø² ÛŒÚ© ØªØºÛŒÛŒØ± Ù…Ù‡Ù… Ø¨Ú©Ø§Ù¾ Ø¨Ú¯ÛŒØ±ÛŒ:

```bash
# Ø¨Ú©Ø§Ù¾ Ø³Ø±ÛŒØ¹
cp ./data/installment_business.db ./data/installment_business.db.emergency_$(date +%Y%m%d_%H%M%S)

# ÛŒØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø³Ú©Ø±ÛŒÙ¾Øª
./backup.sh
```

## ğŸ“ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **Ø¨Ú©Ø§Ù¾ Ø®ÙˆØ¯Ú©Ø§Ø±**: Ø­ØªÙ…Ø§ cron Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†
2. **ÙØ¶Ø§ÛŒ Ø¯ÛŒØ³Ú©**: Ù‡Ø± 30 Ø±ÙˆØ² Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ø­Ø°Ù Ù…ÛŒØ´Ù†
3. **ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ**: Ù…Ø§Ù‡ÛŒ ÛŒÚ©Ø¨Ø§Ø± ØªØ³Øª Ú©Ù† Ú©Ù‡ Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§ Ú©Ø§Ø± Ù…ÛŒÚ©Ù†Ù†
4. **Ø¨Ú©Ø§Ù¾ Ø®Ø§Ø±Ø¬ÛŒ**: Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø¨ÛŒØ´ØªØ±ØŒ Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§ Ø±Ùˆ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ Ù‡Ù… Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
5. **Ù‚Ø¨Ù„ Ø§Ø² Ø¢Ù¾Ø¯ÛŒØª**: Ù‡Ù…ÛŒØ´Ù‡ Ù‚Ø¨Ù„ Ø§Ø² Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø±Ù†Ø§Ù…Ù‡ØŒ Ø¨Ú©Ø§Ù¾ Ø¨Ú¯ÛŒØ±

## ğŸ” Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø±Ø§Ø¨ Ø´Ø¯Ù‡:

```bash
# Ú†Ú© Ú©Ø±Ø¯Ù† integrity
sqlite3 ./data/installment_business.db "PRAGMA integrity_check;"

# Ø§Ú¯Ø± Ø®Ø±Ø§Ø¨ Ø¨ÙˆØ¯ØŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¨Ú©Ø§Ù¾
./restore.sh
```

### ÙØ¶Ø§ÛŒ Ø¯ÛŒØ³Ú© Ú©Ù…:

```bash
# Ø­Ø°Ù Ø¨Ú©Ø§Ù¾â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
find /root/backups/installment-db/ -name "backup_*.db.gz" -mtime +15 -delete

# ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨ÛŒØ´ØªØ±
cd /root/backups/installment-db/
for f in *.gz; do gunzip "$f" && xz -9 "${f%.gz}"; done
```

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø§Ú¯Ø± Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø§ÙˆÙ…Ø¯:
1. Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¨Ú©Ø§Ù¾ Ø±Ùˆ Ú†Ú© Ú©Ù†: `cat /var/log/db-backup.log`
2. ÙˆØ¶Ø¹ÛŒØª Ø¯ÛŒØ³Ú© Ø±Ùˆ Ú†Ú© Ú©Ù†: `df -h`
3. Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ø±Ùˆ Ú†Ú© Ú©Ù†: `ls -la ./data/`
